<!----------------------------------------------------------------------------------------------------
--- Created By:         Team FiPi                                                                  ---
--- Date:               Spring 2017 - Fall 2018                                                    ---
--- Purpose:            Unlock UI for facial recognition app. Allows user to upload photos into    ---
---                     the repository.                                                            ---
---                     Links include:                                                             ---
---                       Dashboard: Displays the name of the user pulled from Google API          ---
---                                  and the status of the lock box.                               ---
---                     Buttons include:                                                           ---
---                       Upload: Allows user to upload photos into the repository.                ---
----------------------------------------------------------------------------------------------------->

<!DOCTYPE html>
<html>
  <!-- Gradient background -->
  <body background = "{{url_for('static', filename = 'img/bg.png')}}">
   
  <!-- Tab name -->
  <title>FiPi Unlock</title>
  
  <!-- References to style sheets -->
  <link rel = "stylesheet" type = "text/css" href = "{{url_for('static', filename = 'css/css.css')}}">
  <link rel = "stylesheet" href = "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

  <!-- Vertical navigation bar -->
  <ul><txt><h3>
  <li><center><img src = " {{ url_for('static', filename= 'img/LogoPic2.PNG')}}" style = "width: 75px; height: 87px;"></center></li><br>
  <li><a href="{{url_for('dashboard') }}">Dashboard</a></li><br><br><br>
  <li><center><butt><span onclick = "window.location.href='{{url_for('upload')}}';">Upload</span></butt></center></li><br><b>
  <li><center><butt><span onclick = "window.location.href='{{url_for('unlock')}}';">Unlock</span></butt></center></li>
  <li><b><center>
  </ul>
  <!-- Middle text box -->
  <br>
  <div style = "margin-left: 28%;">
	<h1><gen>Welcome to FiPi</gen></h1></div>
  <div style = "margin-left:25%; padding: 1px 16px;">
	<txt><h3><p id = "rcorners">Unlock the Box:<br><br><br>
	This page will allow users to attempt to unlock the box using a live photo.
  <div style = "margin-right: 44%;">
	<div id = "container">
		<video autoplay></video>
		<img src="">
		<canvas style="display:none;"></canvas>
	</div>
	<video autoplay></video>
	<img src="">
	<canvas style="display:none;"></canvas>
  </div>
  <video id="player" controls autoplay></video>
  <button id="capture">Capture</button>
  <canvas id="canvas" width=320 height=240></canvas>
  <script src="http://hongru.github.io/proj/canvas2image/canvas2image.js"></script> 
  <script>
  const player = document.getElementById('player');
  const canvas = document.getElementById('canvas');
  const context = canvas.getContext('2d');
  const captureButton = document.getElementById('capture');
  const constraints = {
    video: true,
  };
  captureButton.addEventListener('click', () => {
    // Draw the video frame to the canvas.
    context.drawImage(player, 0, 0, canvas.width, canvas.height);
    canvas.toDataURL("image/png").replace("image/png", "image/octet-stream"); 
    Canvas2Image.saveAsPNG(canvas);
  });
        function downloadImage()
    {
        var canvas = document.getElementById("thecanvas");
        var image = canvas.toDataURL("image/png");
        var aLink = document.createElement('a');
        var evt = document.createEvent("HTMLEvents");
        evt.initEvent("click");
        aLink.download = 'image.png';
        aLink.href = image;
        aLink.dispatchEvent(evt);
    }
  // Attach the video stream to the video element and autoplay.
  navigator.mediaDevices.getUserMedia(constraints)
    .then((stream) => {
      player.srcObject = stream;
    }); 
  </script>
  </p></h3></txt></div>
</html>